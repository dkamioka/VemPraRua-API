<!DOCTYPE html>
<html>
<head>
  <title>VemPraRua</title>
    <style type="text/css">
      html {
        height: 100%;
      }
      
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      #map-canvas {
        height: 100%;
      }
    </style>

    <script
      type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9qzGHxiCcbqQP-lwobg-BMDlircBa7Ec&sensor=false">
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" media="all" href="/assets/app.css" />
    <script type="text/javascript">
      function initialize() {
        var markers = [];
        var mapOptions = {
          center: new google.maps.LatLng(-23.558362, -46.635381),
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
            
        $.ajax({
          url: '/api/users',
          method: 'GET'
        })
        .done(function (data) {
          var infoWindow;
          $('#debug').html(data.users.length + ' manifestantes!');
          if (data.users) {
            $.each(data.users, function (i, user) {
              if (user.latitude != 0.0 && user.longitude != 0.0) {
							  if (user.status) {
							    infoWindow = new google.maps.InfoWindow({content: "<b>" + user.name + ":</b> " + user.status});
							  } else {
							    infoWindow = new google.maps.InfoWindow({content:"<b>" + user.name + "</b>"});
							  }
							  
							  var marker = new google.maps.Marker({
                  position: new google.maps.LatLng(user.latitude, user.longitude),
                  title: user.name,
                  icon: '/assets/pin.png',
                  infoWindow: infoWindow
                });
                markers.push(marker);
                
							  marker.setMap(map);
							  google.maps.event.addListener(marker, 'click', function () {
							    for (var i = 0; i < markers.length; i++) {
							       markers[i].infoWindow.close();
							    }
							    this.infoWindow.open(map, this);
                });
							}
            });
          }
        });
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div id="fork-me-container">
      <a href="https://github.com/fitus/VemPraRua-API" target="_blank">
        <img src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
      </a>
    </div>
    <div id="debug"></div>
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-41928786-1', 'k3x.org');
      ga('send', 'pageview');
    </script>
  </body>
</html>

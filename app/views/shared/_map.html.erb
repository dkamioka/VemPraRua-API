<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

<script type="text/javascript">
  var map;
    function initialize() {
        var mapOptions = {
              zoom: <%= @zoom || @event.zoom %>,
              center: new google.maps.LatLng(<%= @center_lat %>, <%= @center_lng %>),
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };
        map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
    
        var imageBounds = new google.maps.LatLngBounds(
                  new google.maps.LatLng(<%= @event.img_bound_esq_inf_lat %>, <%= @event.img_bound_esq_inf_lng %>),
                  new google.maps.LatLng(<%= @event.img_bound_dir_sup_lat %>, <%= @event.img_bound_dir_sup_lng %>));
    
    
        var contentStrings = new Array();
        var infowindow = new google.maps.InfoWindow();
        var markers = new Array();
    
        <% i=0 %>
        <% @locations.each do |location| %>
            contentStrings[<%=i%>]= '<h2 class="firstHeading"><img src="<%= location.picture %>"> <a target="_blank" href="http://twitter.com/<%=escape_javascript location.twitter %>">@<%=escape_javascript location.twitter %></h2></a>'+
          '<div class="bodyContent">'+
          '<p>'+'<%= location.last_tweet %></p>'+
          '</div>';
          
          markers[<%=i%>] = new google.maps.Marker({
                  position: new google.maps.LatLng(<%=location.lat%>, <%=location.lng%>),
                  map: map,
                  title:"@<%=location.twitter%>"
                });
    
          <% if location == @location %>
              infowindow.setContent(contentStrings[<%=i%>]);
            infowindow.open(map, markers[<%=i%>]);
          <% end %>
          
          google.maps.event.addListener(markers[<%=i%>], 'click', function() {
                  infowindow.setContent(contentStrings[<%=i%>]);
                  infowindow.open(map, markers[<%=i%>]);
                });
    
          <% i+=1 %>
        <% end %>
        
        <%= render "shared/images360" %>
      }

        google.maps.event.addDomListener(window, 'load', initialize);
</script>

